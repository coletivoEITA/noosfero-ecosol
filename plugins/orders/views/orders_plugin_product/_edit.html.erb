<div id="ordered-product-<%=ordered_product.id%>" class="value-row ordered-product" toggleedit="orders.product_edit();">

  <% if @quantity_asked_less_than_minimum and @quantity_asked_less_than_minimum == ordered_product.id %>
    <div class=distribution-error-message>
      <%= t('orders_plugin.views.product._edit.this_product_requires') % {:value => product.minimum_selleable_as_currency_number} %>
    </div>
  <% end %>

  <% f.fields_for "ordered_product-#{ordered_product.id}", ordered_product do |f| %>

    <%= f.hidden_field :id %>

    <div>
      <div class="box-field supplier"><%= excerpt_ending product.supplier.abbreviation_or_name, 15 %></div>
      <div class="box-field product"><%= product.name %></div>

      <div class="box-field quantity">
        <span><%= ordered_product.quantity_asked_as_currency_number %></span>
        <span class="lower"><%= product.unit.singular rescue '' %></span>
      </div>
      <% if order.may_edit? @admin_action %>
        <div class="box-field quantity-edit">
          <%= render :partial => "orders_plugin_product/quantity", :locals => {:product => ordered_product, :f => f} %>
        </div>
      <% end %>

      <div id=<%="product-price-total-#{ordered_product.id.to_s}"%> class="box-field price-total">
        <%= render :partial => "orders_plugin_product/price_total", :locals => {:product => ordered_product} %>
      </div>
    </div>

    <div class="more">

      <div class="actions">
        <% if @admin_action %>
          <%= link_to_function t('orders_plugin.views.product._edit.remove_from_order'), "jQuery(this).parents('.value-row').remove();" if order.may_edit?(@admin_action) %>
        <% else %>
          <%= link_to_remote t('orders_plugin.views.product._edit.remove_from_order'), :update => "ordered-product-#{ordered_product.id}",
            :url => {:controller => 'orders_plugin_product', :action => :destroy, :id => ordered_product.id} if order.may_edit?(@admin_action) %>
        <% end %>
      </div>

      <div class="price-with-unit"><%= price_with_unit_span product.price_as_currency_number, product.unit %></div>

      <div class="clean"></div>
    </div>

    <div class="clean"></div>
  <% end %>
</div>
