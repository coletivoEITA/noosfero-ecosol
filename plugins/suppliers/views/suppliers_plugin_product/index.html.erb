<div id="our-products" class="admin-page">
  <h2>
    <%= t('suppliers_plugin.views.product.index.products') %>
  </h2>

  <div>

   <div class="subtitle">
     <%= t('suppliers_plugin.views.product.index.info') %>
    </div>

    <h3><%= t('suppliers_plugin.views.product.index.default_margin_of_com') %></h3>
    <div class="subtitle">
      <%= t('suppliers_plugin.views.product.index.default_margin_info') %>
    </div>

    <span id="node-margin-percentage">
      <span class="<%= @node.margin_percentage.blank? ? 'none' : 'set' %>">
        <%= @node.margin_percentage_as_currency_number ? ( t('suppliers_plugin.views.product.index.margin') % {:margin => @node.margin_percentage_as_currency_number} ) : t('suppliers_plugin.views.product.index.no_margin_set') %>
      </span>
      <%= colorbox_link_to t('suppliers_plugin.views.product.index.change'), {:controller => :distribution_plugin_node, :action => :margins_change} %>
    </span>

    <h3><%= t('suppliers_plugin.views.product.index.the_products')%></h3>
    <div class="subtitle"><%= link_to t('suppliers_plugin.views.product.index.add_product'), '#our-product-add', :class => 'toggle-edit', :onclick => "suppliers.our_product.add_link();" %></div>

  </div>

  <div id="filter-fields" class="filter-box">
    <strong><%= t('suppliers_plugin.views.product.index.filter') %></strong>

    <% form_remote_tag :update => 'search-results', :url => {:action => :index}, :html => {:id => 'filter-form'}, :method => :get do %>
      <div class="box-field supplier">
        <div><%=t('suppliers_plugin.views.product.index.show_products_from') %></div>
        <div>
          <%= select_tag :supplier_id, options_for_select([[t('suppliers_plugin.views.product.index.all_the_suppliers'), ""]] + supplier_choices(profile), params[:supplier_profile_id].to_i),
            :onchange => "this.form.onsubmit()" %>
        </div>
      </div>

      <div class="box-field category">
        <div><%# t('suppliers_plugin.views.product.index.with_the_category') %></div>
        <div>
          <%# select_tag :category_id, options_for_select(@product_categories.map{ |pc| [pc.name, pc.id]}.insert(0,[t('suppliers_plugin.views.product.index.all_the_categories'), ""])),
            {:onchange => "this.form.onsubmit()"} %>
        </div>
      </div>

      <div class="box-field qualifier">
        <div><%# t('suppliers_plugin.views.product.index.with_the_qualifiers') %></div>
        <div><%# select_tag :qualifier_id, options_for_select([t('suppliers_plugin.views.product.index.anyone'), '']) %></div>
      </div>

      <div class="box-field stock">
        <div><%# t('suppliers_plugin.views.product.index.whose_qty_available_i') %></div>
        <div><%# select_tag :stock, options_for_select([t('suppliers_plugin.views.product.index.bigger_than_the_stock'), '']) %></div>
      </div>

      <div class="box-field name">
        <div><%= t('suppliers_plugin.views.product.index.whose_name_contains') %></div>
        <div><%= text_field_tag :name, params[:name], :onkeydown => "var field = this; function name_form_submit() {field.form.onsubmit();}; setTimeout(name_form_submit, 300);" %></div>
      </div>

      <div class="box-field state">
        <div><%= t('suppliers_plugin.views.product.index.and_being') %></div>
        <div>
          <%= select_tag :available, options_for_select([[t('suppliers_plugin.views.product.index.in_any_state'), ""], [ t('suppliers_plugin.views.product.index.active'), 'true'], [ t('suppliers_plugin.views.product.index.inactive'), 'false']], params[:available]),
            :onchange => "this.form.onsubmit()" %>
        </div>
      </div>
    <% end %>

    <div class="clean"></div>
  </div>

  <div id="search-results">
    <%= render :partial => 'suppliers_plugin_product/search' %>
  </div>

</div>
